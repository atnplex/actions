name: "Repo Bootstrap Aggregator"
description: "The Single Source of Truth workflow that calls all other standard workflows"

on:
  workflow_call:
    inputs:
      enable-lint:
        type: boolean
        default: true
      enable-security:
        type: boolean
        default: true
      allow-ai-artifacts:
        type: boolean
        default: false
      language:
        type: string
        default: "javascript"

jobs:
  enforce-clean:
    if: inputs.allow-ai-artifacts == false
    uses: atnplex/actions/.github/workflows/enforce-clean.yml@chore/init-ssot-actions

  lint:
    if: inputs.enable-lint
    uses: atnplex/actions/.github/workflows/lint.yml@chore/init-ssot-actions
    permissions:
      contents: read

  format:
    if: inputs.enable-lint
    uses: atnplex/actions/.github/workflows/format.yml@chore/init-ssot-actions
    permissions:
      contents: write

  metadata:
    uses: atnplex/actions/.github/workflows/metadata.yml@chore/init-ssot-actions
    permissions:
      pull-requests: read
      statuses: write

  security-scan:
    if: inputs.enable-security
    uses: atnplex/actions/.github/workflows/secret-scan.yml@chore/init-ssot-actions

  codeql:
    if: inputs.enable-security
    uses: atnplex/actions/.github/workflows/codeql.yml@chore/init-ssot-actions
    with:
      language: ${{ inputs.language }}
    permissions:
      security-events: write
      actions: read
      contents: read
